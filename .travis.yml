sudo: required
dist: trusty

language: java
jdk: 
  - oraclejdk7

services:
  - docker

# authenticate docker hub and pull image from repo
before_install:
- docker login -e DCS_PaaS@dell.com -u dcspaas -p Docker@123

# start up and build inside container
script:
- WORKING_DIR=$(pwd)
- docker pull dcspaas/javawebapp:latest
- docker run dcspaas/javawebapp:latest bash
- docker exec cd javawebapp/
- docker exec git pull origin master
- docker exec ant all
- CONTAINER_ID=$(docker ps -lq)

# commit image and push to docker hub
after_success:
- docker commit $CONTAINER_ID dcspaas/javawebapp:latest
- docker create -P dcspaas/javawebapp:latest catalina.sh run
- CONTAINER_ID=$(docker ps -lq)
- docker commit $CONTAINER_ID dcspaas/javawebapp:latest 
- docker push dcspaas/javawebapp:latest